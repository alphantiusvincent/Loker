<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>BawaMap</title>
  <link rel="stylesheet" href="styles.css">
  <link rel="icon" href="Image/logo-BM.png" type="image/x-icon">
</head>
<body>
  <header class="navigasi">
    <div class="container">
      <div class="merek-navigasi">
        <div class="kepala-kartu">
          <div class="logo-perusahaan1">
            <img src="Image/logo-BM.png" alt="logo-BM">
            
          </div>
          <a href="index.html">
            <h1>BawaMap</h1>
        </a>
        </div>
      </div>
      <nav class="menu-navigasi">
        <ul>
          <li><a href="index.html">Beranda</a></li>
          <li><a href="#">Kategori</a></li>
          <li><a href="#">Perusahaan</a></li>
          <li><a href="#">Tentang Kami</a></li>
        </ul>
      </nav>
      <div class="otentikasi-navigasi" id="auth-buttons">
        <a href="login.html"><button class="tombol-masuk">Masuk</button></a>
        <a href="register.html"><button class="tombol-daftar">Daftar</button></a>
      </div>
      <div class="selamat-datang-user" style="display: none;">
        <span id="welcome-message"></span>
        <button class="tombol-logout" id="logout-button">Logout</button>
      </div>
    </div>
  </header>

  <main>
    <div class="container">
      <section class="hero">
        <h1>Temukan Pekerjaan Impian Anda</h1>
        <p>Lebih dari 10.000 lowongan pekerjaan dari berbagai industri tersedia untuk Anda</p>
      </section>

      
      <section class="bagian-pencarian">
        <div class="kartu-pencarian">
          <div class="kepala-pencarian">
            <h2>Cari Lowongan</h2>
          </div>
          <div class="badan-pencarian">
            <form class="formulir-pencarian">
              <div class="baris-pencarian">
                <div class="kolom-pencarian">
                  <label for="kataKunci">Kata Kunci</label>
                  <input type="text" id="kataKunci" name="kataKunci" placeholder="Posisi, jabatan, atau keahlian">
                </div>
                <div class="kolom-pencarian">
                  <label for="kategori">Kategori</label>
                  <select id="kategori" name="kategori">
                    <option value="">Semua Kategori</option>
                    <option value="it">IT & Teknologi</option>
                    <option value="keuangan">Keuangan</option>
                    <option value="pendidikan">Pendidikan</option>
                    <option value="kesehatan">Kesehatan</option>
                    <option value="pemasaran">Pemasaran</option>
                  </select>
                </div>
              </div>
              <div class="baris-pencarian">
                <div class="kolom-pencarian">
                  <label for="lokasi">Lokasi</label>
                  <select id="lokasi" name="lokasi">
                    <option value="">Semua Lokasi</option>
                    <option value="jakarta">Jakarta</option>
                    <option value="bandung">Bandung</option>
                    <option value="surabaya">Surabaya</option>
                    <option value="yogyakarta">Yogyakarta</option>
                    <option value="medan">Medan</option>
                  </select>
                </div>
                <div class="kolom-pencarian">
                  <label for="jenisPekerjaan">Jenis Pekerjaan</label>
                  <select id="jenisPekerjaan" name="jenisPekerjaan">
                    <option value="">Semua Jenis</option>
                    <option value="full-time">Full-time</option>
                    <option value="part-time">Part-time</option>
                    <option value="remote">Remote</option>
                    <option value="freelance">Freelance</option>
                  </select>
                </div>
              </div>
              <div class="baris-pencarian">
                <div class="kolom-pencarian">
                  <label for="gaji">Rentang Gaji</label>
                  <select id="gaji" name="gaji">
                    <option value="">Semua Gaji</option>
                    <option value="0-5">Rp0 - Rp5 juta</option>
                    <option value="5-10">Rp5 - Rp10 juta</option>
                    <option value="10-15">Rp10 - Rp15 juta</option>
                    <option value="15-20">Rp15 - Rp20 juta</option>
                    <option value="20+">Rp20 juta+</option>
                  </select>
                </div>
                <div class="kolom-pencarian kolom-pencarian-tombol">
                  <button type="submit" class="tombol-cari">Cari Lowongan</button>
                </div>
              </div>
            </form>
          </div>
        </div>
      </section>

           <section class="bagian-daftar-pekerjaan">
        <div class="kepala-daftar">
          <h2>Lowongan Pekerjaan Terbaru</h2>
          <p>Daftar lowongan pekerjaan yang baru ditambahkan di platform kami</p>
        </div>

        <div class="daftar-pekerjaan" id="job-listings-container">
                 </div>

        <div class="muat-lagi">
          <button class="tombol-muat-lagi">Muat Lebih Banyak</button>
        </div>
      </section>
    </div>
  </main>

  <div class="modal" id="modalMasuk">
    <div class="konten-modal">
      <span class="tutup-modal">&times;</span>
      <h2>Masuk ke Akun Anda</h2>
      
      <div class="opsi-masuk">
        <button class="opsi-masuk-item aktif" data-target="pencari-kerja">Pencari Kerja</button>
        <button class="opsi-masuk-item" data-target="perusahaan">Perusahaan</button>
      </div>
      
      <form class="formulir-masuk">
        <div class="grup-formulir">
          <label for="namapengguna">Username atau Email</label>
          <input type="text" id="namapengguna" name="namapengguna" required>
        </div>
        
        <div class="grup-formulir">
          <label for="katasandi">Password</label>
          <input type="password" id="katasandi" name="katasandi" required>
        </div>
        
        <div class="grup-formulir grup-kotak-centang">
          <input type="checkbox" id="ingat" name="ingat">
          <label for="ingat">Ingat saya</label>
        </div>
        
        <button type="submit" class="tombol-kirim">Masuk</button>
        
        <div class="footer-formulir">
          <a href="#">Lupa password?</a>
         <p>Belum punya akun? <a href="register.html">Daftar sekarang</a></p>
        </div>
      </form>
    </div>
  </div>

  <footer class="footer">
    <div class="container">
      <div class="konten-footer">
        <div class="tentang-footer">
          <h3>BawaMap</h3>
          <p>Platform pencarian kerja terbaik di Indonesia. Menghubungkan pencari kerja dengan perusahaan terkemuka.</p>
        </div>
        
        <div class="tautan-footer">
          <div class="kolom-footer">
            <h4>Menu</h4>
            <ul>
              <li><a href="index.html">Beranda</a></li>
              <li><a href="#">Lowongan</a></li>
              <li><a href="#">Perusahaan</a></li>
              <li><a href="#">Tips Karir</a></li>
            </ul>
          </div>
          
          <div class="kolom-footer">
            <h4>Kategori</h4>
            <ul>
              <li><a href="#">IT & Teknologi</a></li>
              <li><a href="#">Keuangan</a></li>
              <li><a href="#">Pendidikan</a></li>
              <li><a href="#">Kesehatan</a></li>
              <li><a href="#">Pemasaran</a></li>
            </ul>
          </div>
          
          <div class="kolom-footer">
            <h4>Info Perusahaan</h4>
            <ul>
              <li><a href="#">Tentang Kami</a></li>
              <li><a href="#">Hubungi Kami</a></li>
              <li><a href="#">Kebijakan Privasi</a></li>
              <li><a href="#">Syarat & Ketentuan</a></li>
            </ul>
          </div>
        </div>
      </div>
      
      <div class="footer-bawah">
        <p>&copy; www.BawaMap.co.id</p>
      </div>
    </div>
  </footer>

  <script>
    document.addEventListener('DOMContentLoaded', async function() {
      const authButtonsContainer = document.getElementById('auth-buttons');
      const welcomeUserContainer = document.querySelector('.selamat-datang-user');
      const welcomeMessageSpan = document.getElementById('welcome-message');
      const logoutButton = document.getElementById('logout-button');
      const jobListingsContainer = document.getElementById('job-listings-container');

      // Function to check login status (simulated)
      function checkLoginStatus() {
        const isLoggedIn = localStorage.getItem('isLoggedIn');
        const username = localStorage.getItem('username');

        if (isLoggedIn === 'true' && username) {
          if (authButtonsContainer) {
            authButtonsContainer.style.display = 'none';
          }
          if (welcomeUserContainer) {
            welcomeUserContainer.style.display = 'flex';
          }
          if (welcomeMessageSpan) {
            welcomeMessageSpan.innerHTML = `ðŸ‘‹ Selamat Datang Kembali, <b>${username}</b>!`;
          }
        } else {
          if (authButtonsContainer) {
            authButtonsContainer.style.display = 'flex'; 
          }
          if (welcomeUserContainer) {
            welcomeUserContainer.style.display = 'none';
          }
        }
      }

      // Function to handle logout
      function logout() {
        localStorage.removeItem('isLoggedIn');
        localStorage.removeItem('username');
        localStorage.removeItem('userType');
        localStorage.removeItem('userId');
        window.location.href = 'login.html'; // Redirect to login page
      }

      // Add event listener to logout button
      if (logoutButton) {
        logoutButton.addEventListener('click', logout);
      }

      // Function to load job listings from backend API
      async function loadJobs() {
          try {
              // Ganti URL ini dengan URL API backend Anda (misal: http://localhost:3000/api/lowongan)
              const response = await fetch('http://localhost:3000/api/lowongan'); 
              
              if (!response.ok) {
                  throw new Error(`HTTP error! status: ${response.status}`);
              }
              const jobs = await response.json();

              jobListingsContainer.innerHTML = ''; // Clear previous content

              if (jobs.length === 0) {
                  jobListingsContainer.innerHTML = '<p style="text-align: center; width: 100%; grid-column: 1 / -1;">Tidak ada lowongan pekerjaan yang tersedia saat ini.</p>';
                  return;
              }

              jobs.forEach(job => {
                  // Perbaikan untuk logo dan kategori jika data tidak sesuai format awal
                  const logoSrc = job.logo ? `Image/${job.logo}` : 'Image/default-logo.png'; // Pastikan ada logo default atau tangani jika null
                  const kategoriClass = job.nama_kategori ? `kategori-pekerjaan-${job.nama_kategori.toLowerCase().replace(/ & /g, '_').replace(/ /g, '')}` : 'kategori-pekerjaan-umum';
                  const jenisClass = job.jenis_pekerjaan ? `jenis-pekerjaan-${job.jenis_pekerjaan.toLowerCase()}` : 'jenis-pekerjaan-umum';

                  const jobCard = `
                      <div class="kartu-pekerjaan">
                          <div class="kepala-kartu">
                              <div class="logo-perusahaan">
                                  <img src="${logoSrc}" alt="Logo ${job.nama_perusahaan || 'Perusahaan'}">
                              </div>
                              <div class="tag-pekerjaan">
                                  <span class="kategori-pekerjaan ${kategoriClass}">${job.nama_kategori || 'Umum'}</span>
                                  <span class="jenis-pekerjaan ${jenisClass}">${job.jenis_pekerjaan || 'Full-time'}</span>
                              </div>
                          </div>
                          <div class="konten-kartu">
                              <h3 class="judul-pekerjaan"><a href="detail.html?id=${job.lowongan_id}">${job.judul}</a></h3>
                              <p class="nama-perusahaan">${job.nama_perusahaan || 'Nama Perusahaan Tidak Diketahui'}</p>
                              <div class="lokasi-pekerjaan">
                                  <img src="Image/logo-6.jpeg" alt="Lokasi" class="ikon-kecil">
                                  <span>${job.lokasi_kota || 'Lokasi Tidak Diketahui'}, ${job.lokasi_provinsi || ''}</span>
                              </div>
                              <div class="footer-kartu">
                                  <div class="gaji-pekerjaan">Rp${(job.gaji_min || 0).toLocaleString()} - ${(job.gaji_max || 0).toLocaleString()}/bulan</div>
                                  <div class="deadline-pekerjaan">Deadline: ${new Date(job.tanggal_deadline).toLocaleDateString('id-ID', { day: 'numeric', month: 'long', year: 'numeric' })}</div>
                              </div>
                          </div>
                      </div>
                  `;
                  jobListingsContainer.insertAdjacentHTML('beforeend', jobCard);
              });

          } catch (error) {
              console.error('Error memuat lowongan:', error);
              jobListingsContainer.innerHTML = '<p style="text-align: center; width: 100%; grid-column: 1 / -1;">Gagal memuat lowongan pekerjaan dari server. Pastikan backend berjalan di http://localhost:3000.</p>';
          }
      }

      // Initial calls
      checkLoginStatus();
      loadJobs(); // Load jobs when page loads
    });
  </script>
</body>
</html>