<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Login</title>
    <link rel="stylesheet" href="login.css">
</head>
<body>

<div class="login-container">
    <h2>Login</h2>
    <label for="userType">Login sebagai:</label>
    <select id="userType">
        <option value="jobseeker">Pencari Kerja</option>
        <option value="company">Perusahaan</option>
    </select>
    
    <div id="jobSeekerForm">
        <form id="loginForm" action="#" method="get">
            <div class="form-group">
                <label for="js-username">Username</label>
                <input type="text" id="js-username" name="username" required>
            </div>
            <div class="form-group">
                <label for="js-password">Password</label>
                <input type="password" id="js-password" name="password" required>
            </div>
            <div class="form-group">
                <button type="submit">Login</button>
            </div>
            <div class="form-group" style="margin-top: 15px; text-align: center;">
                <p>Belum punya akun? <a href="register.html">Daftar sekarang</a></p>
            </div>
        </form>
    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        const loginForm = document.getElementById('loginForm');
        
        loginForm.addEventListener('submit', async function(event) {
            event.preventDefault(); // Mencegah form dari submit default

            const usernameInput = document.getElementById('js-username');
            const passwordInput = document.getElementById('js-password');
            const username = usernameInput.value;
            const password = passwordInput.value;

            try {
                // KIRIM DATA LOGIN KE BACKEND
                // URL ini harus sesuai dengan URL backend Anda (misal: http://localhost:3000/api/login)
                const response = await fetch('http://localhost:3000/api/login', { 
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ username, password })
                });

                const data = await response.json();

                if (response.ok) { // Jika respons 2xx (sukses) dari backend
                    alert(data.message); // Tampilkan pesan sukses dari backend
                    localStorage.setItem('isLoggedIn', 'true');
                    localStorage.setItem('username', data.username); // Ambil username dari respons backend
                    localStorage.setItem('userType', data.userType || 'pencari_kerja'); // Simpan tipe user
                    localStorage.setItem('userId', data.userId || '1'); // Simpan ID user (contoh default jika tidak ada)

                    window.location.href = 'index.html'; // Redirect ke halaman utama
                } else {
                    // Jika respons 4xx atau 5xx (gagal) dari backend
                    alert('Login gagal: ' + (data.message || 'Terjadi kesalahan.')); 
                }
            } catch (error) {
                console.error('Error saat melakukan fetch:', error);
                alert('Terjadi kesalahan saat mencoba login. Pastikan backend berjalan di http://localhost:3000.');
            }
        });
    });
</script>

</body>
</html>